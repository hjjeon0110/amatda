<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Trainer">
  
<resultMap type="com.kh.amd.member.model.vo.TrainerInfo" id="trainerResultSet">
      <id property="mno" column="TNO"/>            <!-- DB 기본키 -->
      <result property="accountName" column="ACCOUNT_NAME"/>
      <result property="bankCode" column="BANKCODE"/>   <!-- 일반컬럼 -->
      <result property="accountNo" column="ACCOUNT_NO"/>
      <result property="tage" column="TAGE"/>
      <result property="topen" column="TOPEN"/>
      <result property="remainNum" column="REMAIN_NUM"/>
</resultMap>
<resultMap type="com.kh.amd.trainer.model.vo.Profile" id="profileResultSet">
	<id property="profileno" column="PROFILE_NO"/>
	<result property="lineProfile" column="LINE_PROFILE"/>
	<result property="proTitle" column="PRO_TITLE"/>
	<result property="intro" column="INTRO"/>
	<result property="media" column="MEDIA"/>
	<result property="certificate" column="CERTIPICATE"/>
	<result property="keyword" column="KEYWORD"/>
</resultMap>
<resultMap type="Estimate" id="estimateResultSet">
	<id property="estNo" column="EST_NO"/>
	<result property="estName" column="EST_NAME"/>
	<result property="estPrice" column="EST_COST"/>
	<result property="estDay" column="TRAINING_DAYS"/>
	<result property="estContents" column="EST_CONTENTS"/>
	<result property="estType" column="EST_TYPE"/>
	<result property="tno" column="TNO"/>
</resultMap>
<resultMap type="Attachment" id="attachmentResultSet">
	<id property="fileNo" column="FILE_NO"/>
	<result property="bno" column="BNO"/>
	<result property="pno" column="PNO"/>
	<result property="link" column="LINK"/>
	<result property="oriName" column="ORI_NAME"/>
	<result property="modiName" column="MODI_NAME"/>
	<result property="fileLevel" column="FILE_LEVEL"/>
	<result property="uploadDate" column="UPLOAD_DATE"/>
	<result property="aType" column="ATYPE"/>
	<result property="aStatus" column="A_STATUS"/>
	<result property="filePath" column="FILE_PATH"/>
</resultMap>

   
   <!-- 트레이너 추가 정보 회원가입 -->
   <insert id="insertTrainerInfo" parameterType="TrainerInfo">
   		INSERT INTO TUSER_INFO
   		VALUES(#{mno}, #{accountName}, #{bankCode}, #{accountNo}, null, 'Y', null)
   </insert>
   
   <!-- 프로필 작성 여부 확인 (전효정) -->
   <select id="checkProfile" resultMap="profileResultSet" parameterType="Profile">
   		SELECT PROFILE_NO, LINE_PROFILE, PRO_TITLE, INTRO, MEDIA, CERTIPICATE, KEYWORD FROM PROFILE WHERE TNO IN (#{mno}) 
   </select>
   
   <!-- 서브 메뉴바내에서 견적서를 클릭시 로그인한 회원의 1번 견적서 열람 -->
   <select id="selectEstimate" resultMap="estimateResultSet" parameterType="java.util.Map">
   		SELECT E.EST_NAME, E.EST_COST, E.EST_CONTENTS, E.EST_TYPE, E.EST_NO, E.TNO, E.TRAINING_DAYS
		FROM ESTIMATE E
		JOIN MEMBER M ON (E.TNO = M.MNO)
		WHERE E.EST_TYPE = #{iestType}
		AND TNO = #{MNO}
   </select>

   
   <!-- 프로필 이미지 존재 여부 확인 (전효정) -->
   <select id="checkProfileImg" resultMap="attachmentResultSet" parameterType="Attachment">
   		SELECT FILE_NO, PNO, ORI_NAME, MODI_NAME, FILE_LEVEL, UPLOAD_DATE, A_STATUS, FILE_PATH  FROM ATTACHMENT WHERE PNO IN (#{mno}) 
   </select>
   
   <!-- 프로필 사진 insert (전효정) -->
   <insert id="insertProfileImg" parameterType="Attachment">
   		INSERT INTO ATTACHMENT VALUES(FILE_SEQ.NEXTVAL, NULL, #{mno}, NULL, #{originalFilename}, #{changeName}, 0, SYSDATE, 0, 'Y', #{filePath})
   </insert>
   
   <!-- 프로필 사진 수정 (전효정) -->
   <update id="modifyProfileImg" parameterType="Attachment">
   		UPDATE ATTACHMENT SET ORI_NAME = #{originalFilename}, MODI_NAME = #{changeName}, FILE_PATH = #{filePath}, UPLOAD_DATE = SYSDATE
	
   </update>
   <insert id="insertEstimate" parameterType="Estimate">
   		INSERT INTO ESTIMATE
   		VALUES(EST_SEQ.NEXTVAL, #{tno}, #{estName}, #{estPrice}, #{estDay}, #{estContents}, #{estType})
   
   </insert>
   <update id="updateEstimate" parameterType="Estimate">
   		UPDATE ESTIMATE
  		SET EST_NAME = #{estName},
  			EST_COST = #{estPrice},
  			TRAINING_DAYS = #{estDay},
  			EST_CONTENTS = #{estContents}
  		WHERE TNO = #{tno}
  		AND EST_TYPE = #{estType}


  
</update>
</mapper>


	












